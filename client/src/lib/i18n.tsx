import { createContext, useContext, useState, useEffect, type ReactNode } from 'react';

type Lang = 'en' | 'ru';

const translations = {
  en: {
    subtitle: '5-Card Omaha Equity Calculator',
    heroTitle1: 'Master PLO5 with',
    heroTitle2: 'Precision Equity',
    heroDesc: 'Professional-grade 5-Card Omaha equity calculator. Analyze hands, study ranges, and make better decisions at the table with exhaustive calculations that match ProPokerTools Oracle.',
    signInGoogle: 'Sign in with Google',
    signInReplit: 'Sign in with Replit',
    freePlan: 'Free forever plan',
    noCreditCard: 'No credit card required',
    preflopRunouts: 'Preflop runouts calculated',
    whyChoose: 'Why Choose Plozilla?',
    exhaustiveCalc: 'Exhaustive Calculations',
    exhaustiveCalcDesc: 'Every calculation enumerates all possible runouts. No Monte Carlo approximations - get exact equity values that match ProPokerTools Oracle.',
    wasmSpeed: 'WebAssembly Speed',
    wasmSpeedDesc: 'Powered by a custom WASM evaluator with Two Plus Two lookup tables. Calculate 850K+ runouts in seconds, all in your browser.',
    fullRange: 'Full Range Support',
    fullRangeDesc: 'Use ProPokerTools Generic Syntax for ranges: AA, KK+, suited connectors, suit variables, and weighted ranges.',
    features: 'Features',
    feature1: '5-Card Omaha (PLO5) equity calculations',
    feature2: 'Board states: Preflop, Flop, Turn, River',
    feature3: 'Up to 8 players with visual card display',
    feature4: 'Hand history import with street selection',
    feature5: 'Full ProPokerTools range syntax',
    feature6: 'Cached preflop calculations for instant results',
    exampleCalc: 'Example calculation:',
    board: 'Board',
    hero: 'Hero',
    villain: 'Villain',
    villainRange: 'Villain Range',
    result: 'Result',
    runouts: 'runouts',
    footer: 'Plozilla - Professional 5-Card Omaha Equity Calculator',

    navEquity: 'Equity',
    navTableEv: 'Table EV',
    navRankings: 'Hand Rankings',
    navLearn: 'Learn',
    pleaseLogIn: 'Please log in',
    redirecting: 'Redirecting to login...',
    user: 'User',

    totalEv: 'Total Expected Value',
    reset: 'Reset',
    regsHero: 'Regs + Hero (N-reg)',
    heroRake: 'Hero Rake (bb/100)',
    rakebackPct: 'Rakeback (%)',
    calcDetails: 'Calculation Details',
    againstFish: 'Against Fish (Seat {n})',
    realLoserate: 'Real Loserate:',
    shareN: 'Share (N={n}):',
    posCoef: 'Position Coef:',
    fishEvContrib: 'Fish EV contribution:',
    sumFishEv: 'Sum of Fish EV:',
    heroRakeLabel: 'Hero Rake:',
    rakebackLabel: 'Rakeback ({n}%):',
    effectiveRake: 'Effective Rake:',
    finalEv: 'Final EV:',
    table: 'Table',
    howItWorks: 'How does it work?',
    configureSeat: 'Configure Seat {n}',
    playerType: 'Player Type',
    vpipPct: 'VPIP %',
    selectVpip: 'Select VPIP...',
    threeBet: '3bet 30%+',
    reducedCoefs: 'Reduced position coefficients',
    loseRate: 'Lose Rate (bb/100)',
    rake: 'Rake (bb/100)',
    cancel: 'Cancel',
    save: 'Save',
    empty: 'EMPTY',

    infoTitle: 'How Table EV Calculator Works',
    infoCoreFormula: 'Core Formula',
    infoCoreFormulaText: 'EV = Sum of Fish EV contributions - Effective Hero Rake',
    infoStep1: 'Step 1: Real Loserate',
    infoStep1Desc: 'Each fish has a total loserate and a rake component. The real loserate is the net amount other players win from this fish:',
    infoStep1Formula: 'Real Loserate = Fish Loserate - Fish Rake',
    infoStep1Note: 'Fish Rake goes to the poker room, not to other players.',
    infoStep2: 'Step 2: Share per Reg',
    infoStep2Desc: 'The real loserate is split equally among all regs (including Hero) at the table:',
    infoStep2Formula: 'Share = Real Loserate / N_regs',
    infoStep2Note: 'N_regs = number of Reg + Hero players.',
    infoStep3: 'Step 3: Position Coefficient',
    infoStep3Desc: 'Your position relative to the fish matters. Sitting closer (to the left) gives you a higher coefficient because you act after the fish more often:',
    normalFish: 'Normal Fish',
    threeBetFish: '3bet 30%+ Fish',
    directLeft: 'fish+1 (direct left):',
    infoStep3Note: '3bet fish reduces positional advantage because aggressive 3-betting narrows the skill edge from position.',
    infoStep4: 'Step 4: EV per Fish',
    infoStep4Desc: 'For each fish at the table, your EV contribution is:',
    infoStep4Formula: 'Fish EV = (Real Loserate / N_regs) * Position Coef',
    infoStep5: 'Step 5: Hero Rake & Rakeback',
    infoStep5Desc: 'Your own rake is subtracted once from the total. Rakeback reduces the effective rake:',
    infoStep5Formula: 'Effective Rake = Hero Rake * (1 - Rakeback% / 100)',
    infoFinalResult: 'Final Result',
    infoFinalFormula: 'Total EV = Sum(Fish EV) - Effective Hero Rake',
    infoFinalNote: 'Result is in bb/100 (big blinds per 100 hands).',
    infoExample: 'Example',
    infoExampleSetup: '1 Fish (VPIP 90%, Loserate 200, Rake 41), 4 Regs + Hero, Hero at fish+1',

    learnTitle: 'Poker Hand Rankings & Omaha Rules',
    learnDesc: 'Understanding poker mathematics and 5-card Omaha',
    omahaRules: '5-Card Omaha Rules',
    omahaRulesP1: 'In 5-card Omaha, each player receives <strong>5 hole cards</strong> and must use <strong>exactly 2</strong> of them combined with <strong>exactly 3</strong> of the 5 community board cards to make the best 5-card poker hand.',
    omahaRulesP2: "This is different from Texas Hold'em where you can use any combination of your hole cards and board cards.",
    omahaExample: 'Example:',
    omahaExampleText: 'If you have <code class="bg-background px-1 rounded">AhKhQhJhTh</code> (all hearts), you cannot make a flush unless 3 hearts appear on the board, because you must use exactly 2 hole cards and 3 board cards.',
    handRankings: 'Hand Rankings (Best to Worst)',
    royalFlush: 'Royal Flush',
    royalFlushDesc: 'A, K, Q, J, 10 all of the same suit',
    straightFlush: 'Straight Flush',
    straightFlushDesc: 'Five cards in sequence, all of the same suit',
    fourOfKind: 'Four of a Kind',
    fourOfKindDesc: 'Four cards of the same rank',
    fullHouse: 'Full House',
    fullHouseDesc: 'Three of a kind plus a pair',
    flush: 'Flush',
    flushDesc: 'Five cards of the same suit (not in sequence)',
    straight: 'Straight',
    straightDesc: 'Five cards in sequence (not same suit)',
    threeOfKind: 'Three of a Kind',
    threeOfKindDesc: 'Three cards of the same rank',
    twoPair: 'Two Pair',
    twoPairDesc: 'Two different pairs',
    onePair: 'One Pair',
    onePairDesc: 'Two cards of the same rank',
    highCard: 'High Card',
    highCardDesc: 'No matching cards',
    understandingEquity: 'Understanding Equity',
    equityP1: '<strong>Equity</strong> represents your expected share of the pot based on your probability of winning. It\'s calculated by simulating all possible remaining board cards and determining how often each player wins.',
    equityP2: 'For example, if you have 60% equity, you expect to win 60% of the pot on average.',
    calcMethod: 'Calculation Method:',
    calcStep1: 'Enumerate all possible remaining board cards',
    calcStep2: "For each complete board, evaluate each player's best hand",
    calcStep3: 'Count wins, ties, and losses for each player',
    calcStep4: 'Equity = (Wins + Ties/2) / Total Trials × 100%',
    cardNotation: 'Card Notation',
    cardNotationDesc: 'This tool uses standard poker notation in concatenated format:',
    ranks: 'Ranks:',
    ace: 'Ace (highest)',
    king: 'King',
    queen: 'Queen',
    jack: 'Jack',
    ten: 'Ten',
    numberCards: 'Number cards',
    suits: 'Suits:',
    spades: 'Spades',
    hearts: 'Hearts',
    diamonds: 'Diamonds',
    clubs: 'Clubs',
    examples: 'Examples:',
    cardExample1: '6sKh7hKdAc = 6 spades, K hearts, 7 hearts, K diamonds, A clubs',
    cardExample2: 'Th5d7c = 10 hearts, 5 diamonds, 7 clubs (board)',

    handImport: 'Hand Import',
    selectStreet: 'Select street for analysis',
    foundHands: 'Found hands:',
    boardLabel: 'Board:',
    selectStreetLabel: 'Select street:',
    cards: 'cards',
    close: 'Close',
    pasteError1: 'Could not parse hand history format',
    pasteError2: 'No player hands found in history',
    pasteError3: 'Could not read clipboard. Please allow clipboard access.',
    calculate: 'Calculate',
    calculating: 'Calculating...',
    addPlayer: 'Add Player',
    preflop: 'Preflop',
    flop: 'Flop',
    turn: 'Turn',
    river: 'River',
    player: 'Player',
    win: 'Win',
    tie: 'Tie',
    boardInputLabel: 'Board (Preflop: 0 | Flop: 3 | Turn: 4 | River: 5)',
    pasteHand: 'Paste Hand',
    cached: 'Cached',
    exact: 'exact',
    combos: 'combos',
    equityResults: 'Equity Results',
    trials: 'trials',
    total: 'Total',
    bestHand: 'Best hand',
    clear: 'Clear',
    appButton: 'APP',
    calcDesc: 'Enter hands (7s6hJdQc8c) or ranges (AA, KK+, AK$s). Ranges use Monte Carlo sampling.',
    playersLabel: 'Players (5 cards each, min 2 required)',
    invalidBoard: 'Invalid: need more cards',
    rankingsTitle: 'Hand Rankings',
    rankingsDesc: '134,459 canonical PLO5 starting hands ranked by preflop equity vs a random opponent.',
    rankingsRank: '#',
    rankingsHand: 'Hand',
    rankingsType: 'Type',
    rankingsCombos: 'Combos',
    rankingsPercentile: 'Rank%',
    rankingsNote: 'Hands are suit-canonicalized: structurally identical hands (differing only in suit labels) are grouped together. Each canonical hand is evaluated with 10,000 MC trials vs a random opponent.',
    rankingsInfoButton: 'How rankings work',
    rankingsInfoTitle: 'How PLO5 Hand Rankings Work',
    rankingsInfoMethodTitle: 'Methodology',
    rankingsInfoMethod: 'Each of the 134,459 suit-isomorphic (canonical) PLO5 starting hands is evaluated against a random opponent using Monte Carlo simulation. The equity shown is the average win percentage over thousands of randomly dealt boards.',
    rankingsInfoCRNTitle: 'Common Random Numbers (CRN)',
    rankingsInfoCRN: 'To produce stable, reproducible rankings, the engine uses the CRN technique: the same set of random boards is shared across all hands. This greatly reduces relative variance between hands, meaning even with fewer trials, the ranking order is highly reliable.',
    rankingsInfoCanonTitle: 'Suit Canonicalization',
    rankingsInfoCanon: 'Hands that differ only in suit labels are structurally identical (e.g., AhKhQdJd5c and AsKsQcJc5d play the same way). These are grouped into a single canonical hand. The "Combos" column shows how many concrete deals map to each canonical form (typically 4-24).',
    rankingsInfoColumnsTitle: 'Column Guide',
    rankingsInfoColumnRank: '# — Global rank (1 = best hand)',
    rankingsInfoColumnHand: 'Hand — The 5 cards in canonical suit notation',
    rankingsInfoColumnCombos: 'Combos — Number of concrete 5-card deals that map to this canonical hand',
    rankingsInfoColumnEQ: 'EQ% — Preflop equity vs a random opponent (Monte Carlo)',
    rankingsInfoColumnRankPct: 'Rank% — Percentile position (0% = top, 100% = bottom)',
    rankingsInfoSearchTitle: 'Search Syntax',
    rankingsInfoSearch: 'Use ProPokerTools-style syntax to filter hands. Examples: AA (any hand with a pair of aces), KK+ (kings or better), TT+ds (tens+ double-suited), 20% (top 20% of hands), 5%-10% (hands between 5th and 10th percentile).',
    rankingsEquity: 'EQ%',
    rankingsTotal: 'Total hands',
    rankingsCanonicalTotal: '{n} canonical hands (suit-isomorphic)',
    rankingsShowing: 'Showing',
    rankingsPerPage: 'Per page',
    rankingsDbNotFound: 'Rankings database not found',
    rankingsDbNotFoundDesc: 'Rankings database not found. Run scripts/precompute_rankings first.',
    rankingsDS: 'ds',
    rankingsSS: 'ss',
    rankingsSearch: 'Search hand or percent',
    rankingsSearchPlaceholder: 'AA, AA!KK, KK+, TT+ds, AA,KK, 20%',
    rankingsFound: 'Found',
    rankingsTopPercent: 'Top {n}%',
    rankingsPercentRange: '{a}% — {b}%',
    rankingsNoResults: 'No hands found',
    rankingsNotReady: 'Rankings are being prepared. Please check back shortly.',
    catAll: 'All Hands',
    catUnpaired: 'Unpaired',
    catOnePair: 'One Pair',
    catTwoPair: 'Two Pair',
    catTrips: 'Trips',
    catDS: 'Double-Suited',
    catSS: 'Single-Suited',
    catRundown5: '5-Card Rundown',
    catRundown4: '4-Card Rundown',
    catBroadway3: '3+ Broadway',
    catBroadway2Low3: '2 Broadway + Low',
    catRagged: 'Ragged',
    catCategories: 'Categories',
    catHandsCount: '{n} hands',
    trialsLabel: 'Trials',
    seedLabel: 'Seed',
    seedPlaceholder: 'e.g. 12345',
    benchmark: 'Benchmark',
    benchmarkRunning: 'Running...',
    benchmarkDone: 'Benchmark done',
    need5Cards: 'Need exactly 5 cards',
    trialsShort100k: '100K',
    trialsShort300k: '300K',
    trialsShort600k: '600K',
    trialsShort2m: '2M',
    serverCalculating: 'Calculating on server...',
    serverBusy: 'Server is busy, please try again in a moment',
    serverError: 'Server error',
    serverTimeout: 'Calculation timed out',
    engineLabel: 'Rust engine',
    breakdownTitle: 'EQ Breakdown (Next Street)',
    breakdownEmpty: 'Run a calculation with breakdown enabled to see equity by next card',
    breakdownDesc: 'Equity for each possible next card',
    breakdownToggle: 'Show EQ breakdown',
    breakdownRunning: 'Computing breakdown...',
    breakdownCard: 'Card',
    breakdownEquity: 'Equity',
    breakdownTrials: 'Trials',
    breakdownShowAll: 'Show all ({n})',
    breakdownShowTop: 'Show top 20',
    breakdownFlopToTurn: 'Flop → Turn',
    breakdownTurnToRiver: 'Turn → River',
    breakdownNotAvailable: 'Breakdown available only on Flop or Turn',
    breakdownBudget: 'Budget',
    breakdownBaseline: 'Baseline equity (current street)',
    breakdownDelta: 'Δ',
    breakdownFilterBetter: 'Only better than baseline',
    breakdownShowTopN: 'Top {n}',
    breakdownTabCards: 'Cards',
    breakdownTabByRank: 'By Rank',
    breakdownRank: 'Rank',
    breakdownAvgEquity: 'Avg EQ',
    breakdownBestSuit: 'Best',
    breakdownCount: 'Count',
    breakdownNormalize: 'Normalize bars',
  },
  ru: {
    subtitle: 'Калькулятор эквити 5-Card Omaha',
    heroTitle1: 'Освой PLO5 с',
    heroTitle2: 'точным эквити',
    heroDesc: 'Профессиональный калькулятор эквити для 5-Card Omaha. Анализируй руки, изучай диапазоны и принимай лучшие решения за столом с точными расчётами как в ProPokerTools Oracle.',
    signInGoogle: 'Войти через Google',
    signInReplit: 'Войти через Replit',
    freePlan: 'Бесплатно навсегда',
    noCreditCard: 'Без банковской карты',
    preflopRunouts: 'Префлоп ранаутов рассчитано',
    whyChoose: 'Почему Plozilla?',
    exhaustiveCalc: 'Точные расчёты',
    exhaustiveCalcDesc: 'Каждый расчёт перебирает все возможные ранауты. Никаких приближений Монте-Карло — получай точные значения эквити как в ProPokerTools Oracle.',
    wasmSpeed: 'Скорость WebAssembly',
    wasmSpeedDesc: 'Работает на кастомном WASM-движке с таблицами Two Plus Two. 850K+ ранаутов за секунды, прямо в браузере.',
    fullRange: 'Полная поддержка диапазонов',
    fullRangeDesc: 'Используй синтаксис ProPokerTools Generic: AA, KK+, одномастные коннекторы, переменные мастей и взвешенные диапазоны.',
    features: 'Возможности',
    feature1: 'Расчёт эквити 5-Card Omaha (PLO5)',
    feature2: 'Улицы: Префлоп, Флоп, Тёрн, Ривер',
    feature3: 'До 8 игроков с визуальным отображением карт',
    feature4: 'Импорт историй раздач с выбором улицы',
    feature5: 'Полный синтаксис диапазонов ProPokerTools',
    feature6: 'Кэшированные префлоп-расчёты для мгновенных результатов',
    exampleCalc: 'Пример расчёта:',
    board: 'Борд',
    hero: 'Хиро',
    villain: 'Виллен',
    villainRange: 'Диапазон виллена',
    result: 'Результат',
    runouts: 'ранаутов',
    footer: 'Plozilla — Профессиональный калькулятор эквити 5-Card Omaha',

    navEquity: 'Эквити',
    navTableEv: 'Table EV',
    navRankings: 'Рейтинг рук',
    navLearn: 'Обучение',
    pleaseLogIn: 'Необходимо войти',
    redirecting: 'Перенаправление на вход...',
    user: 'Пользователь',

    totalEv: 'Общий Expected Value',
    reset: 'Сброс',
    regsHero: 'Реги + Хиро (N-reg)',
    heroRake: 'Рейк хиро (bb/100)',
    rakebackPct: 'Рейкбэк (%)',
    calcDetails: 'Детали расчёта',
    againstFish: 'Против фиша (Сит {n})',
    realLoserate: 'Реальный лузрейт:',
    shareN: 'Доля (N={n}):',
    posCoef: 'Коэф. позиции:',
    fishEvContrib: 'EV от фиша:',
    sumFishEv: 'Сумма EV от фишей:',
    heroRakeLabel: 'Рейк хиро:',
    rakebackLabel: 'Рейкбэк ({n}%):',
    effectiveRake: 'Эффективный рейк:',
    finalEv: 'Итоговый EV:',
    table: 'Стол',
    howItWorks: 'Как это работает?',
    configureSeat: 'Настройка сита {n}',
    playerType: 'Тип игрока',
    vpipPct: 'VPIP %',
    selectVpip: 'Выберите VPIP...',
    threeBet: '3bet 30%+',
    reducedCoefs: 'Сниженные коэффициенты позиций',
    loseRate: 'Лузрейт (bb/100)',
    rake: 'Рейк (bb/100)',
    cancel: 'Отмена',
    save: 'Сохранить',
    empty: 'ПУСТО',

    infoTitle: 'Как работает калькулятор Table EV',
    infoCoreFormula: 'Основная формула',
    infoCoreFormulaText: 'EV = Сумма EV от фишей - Эффективный рейк хиро',
    infoStep1: 'Шаг 1: Реальный лузрейт',
    infoStep1Desc: 'У каждого фиша есть общий лузрейт и рейк. Реальный лузрейт — это чистая сумма, которую выигрывают другие игроки у этого фиша:',
    infoStep1Formula: 'Реальный лузрейт = Лузрейт фиша - Рейк фиша',
    infoStep1Note: 'Рейк фиша уходит покер-руму, а не другим игрокам.',
    infoStep2: 'Шаг 2: Доля на рега',
    infoStep2Desc: 'Реальный лузрейт делится поровну между всеми регами (включая хиро) за столом:',
    infoStep2Formula: 'Доля = Реальный лузрейт / N_reg',
    infoStep2Note: 'N_reg = количество Рег + Хиро игроков.',
    infoStep3: 'Шаг 3: Коэффициент позиции',
    infoStep3Desc: 'Ваша позиция относительно фиша имеет значение. Чем ближе вы слева, тем выше коэффициент, потому что вы чаще действуете после фиша:',
    normalFish: 'Обычный фиш',
    threeBetFish: '3bet 30%+ фиш',
    directLeft: 'fish+1 (слева):',
    infoStep3Note: '3bet фиш снижает позиционное преимущество, потому что агрессивный 3бет сужает эдж от позиции.',
    infoStep4: 'Шаг 4: EV от фиша',
    infoStep4Desc: 'Для каждого фиша за столом ваш вклад в EV составляет:',
    infoStep4Formula: 'EV фиша = (Реальный лузрейт / N_reg) * Коэф. позиции',
    infoStep5: 'Шаг 5: Рейк хиро и рейкбэк',
    infoStep5Desc: 'Ваш собственный рейк вычитается один раз из общей суммы. Рейкбэк уменьшает эффективный рейк:',
    infoStep5Formula: 'Эфф. рейк = Рейк хиро * (1 - Рейкбэк% / 100)',
    infoFinalResult: 'Итоговый результат',
    infoFinalFormula: 'Итого EV = Сумма(EV фишей) - Эфф. рейк хиро',
    infoFinalNote: 'Результат в bb/100 (большие блайнды на 100 рук).',
    infoExample: 'Пример',
    infoExampleSetup: '1 Фиш (VPIP 90%, Лузрейт 200, Рейк 41), 4 Рега + Хиро, Хиро на fish+1',

    learnTitle: 'Рейтинг рук и правила Омахи',
    learnDesc: 'Покерная математика и 5-card Omaha',
    omahaRules: 'Правила 5-Card Omaha',
    omahaRulesP1: 'В 5-карточной Омахе каждый игрок получает <strong>5 карманных карт</strong> и должен использовать <strong>ровно 2</strong> из них в комбинации с <strong>ровно 3</strong> из 5 общих карт борда для составления лучшей 5-карточной покерной руки.',
    omahaRulesP2: "Это отличается от Texas Hold'em, где можно использовать любую комбинацию карманных карт и карт борда.",
    omahaExample: 'Пример:',
    omahaExampleText: 'Если у вас <code class="bg-background px-1 rounded">AhKhQhJhTh</code> (все черви), вы не сможете собрать флеш, пока на борде не появятся 3 черви, потому что нужно использовать ровно 2 карманные карты и 3 карты борда.',
    handRankings: 'Рейтинг рук (от лучшей к худшей)',
    royalFlush: 'Роял-флеш',
    royalFlushDesc: 'A, K, Q, J, 10 одной масти',
    straightFlush: 'Стрит-флеш',
    straightFlushDesc: 'Пять карт по порядку, одной масти',
    fourOfKind: 'Каре',
    fourOfKindDesc: 'Четыре карты одного ранга',
    fullHouse: 'Фулл-хаус',
    fullHouseDesc: 'Тройка плюс пара',
    flush: 'Флеш',
    flushDesc: 'Пять карт одной масти (не по порядку)',
    straight: 'Стрит',
    straightDesc: 'Пять карт по порядку (разные масти)',
    threeOfKind: 'Тройка',
    threeOfKindDesc: 'Три карты одного ранга',
    twoPair: 'Две пары',
    twoPairDesc: 'Две разные пары',
    onePair: 'Одна пара',
    onePairDesc: 'Две карты одного ранга',
    highCard: 'Старшая карта',
    highCardDesc: 'Нет совпадений',
    understandingEquity: 'Что такое эквити',
    equityP1: '<strong>Эквити</strong> — это ваша ожидаемая доля банка, основанная на вероятности выигрыша. Рассчитывается путём моделирования всех возможных оставшихся карт борда и определения частоты побед каждого игрока.',
    equityP2: 'Например, если у вас эквити 60%, вы ожидаете выиграть 60% банка в среднем.',
    calcMethod: 'Метод расчёта:',
    calcStep1: 'Перебрать все возможные оставшиеся карты борда',
    calcStep2: 'Для каждого полного борда оценить лучшую руку каждого игрока',
    calcStep3: 'Посчитать победы, ничьи и проигрыши каждого игрока',
    calcStep4: 'Эквити = (Победы + Ничьи/2) / Всего раздач × 100%',
    cardNotation: 'Обозначение карт',
    cardNotationDesc: 'Инструмент использует стандартную покерную нотацию в сжатом формате:',
    ranks: 'Ранги:',
    ace: 'Туз (старший)',
    king: 'Король',
    queen: 'Дама',
    jack: 'Валет',
    ten: 'Десятка',
    numberCards: 'Числовые карты',
    suits: 'Масти:',
    spades: 'Пики',
    hearts: 'Черви',
    diamonds: 'Бубны',
    clubs: 'Трефы',
    examples: 'Примеры:',
    cardExample1: '6sKh7hKdAc = 6 пик, K червей, 7 червей, K бубен, A треф',
    cardExample2: 'Th5d7c = 10 червей, 5 бубен, 7 треф (борд)',

    handImport: 'Импорт раздачи',
    selectStreet: 'Выберите улицу для анализа',
    foundHands: 'Найденные руки:',
    boardLabel: 'Борд:',
    selectStreetLabel: 'Выберите улицу:',
    cards: 'карт',
    close: 'Закрыть',
    pasteError1: 'Не удалось распознать формат истории раздачи',
    pasteError2: 'Не найдены руки игроков в истории',
    pasteError3: 'Не удалось прочитать буфер обмена. Разрешите доступ к буферу.',
    calculate: 'Рассчитать',
    calculating: 'Расчёт...',
    addPlayer: 'Добавить игрока',
    preflop: 'Префлоп',
    flop: 'Флоп',
    turn: 'Тёрн',
    river: 'Ривер',
    player: 'Игрок',
    win: 'Победа',
    tie: 'Ничья',
    boardInputLabel: 'Борд (Префлоп: 0 | Флоп: 3 | Тёрн: 4 | Ривер: 5)',
    pasteHand: 'Вставить раздачу',
    cached: 'Кэш',
    exact: 'точно',
    combos: 'комбо',
    equityResults: 'Результаты эквити',
    trials: 'проб',
    total: 'Всего',
    bestHand: 'Лучшая рука',
    clear: 'Очистить',
    appButton: 'APP',
    calcDesc: 'Введите руки (7s6hJdQc8c) или диапазоны (AA, KK+, AK$s). Диапазоны используют Монте-Карло.',
    playersLabel: 'Игроки (5 карт, минимум 2)',
    invalidBoard: 'Ошибка: нужно больше карт',
    rankingsTitle: 'Рейтинг рук',
    rankingsDesc: '134 459 канонических стартовых рук PLO5, ранжированных по эквити на префлопе vs случайный оппонент.',
    rankingsRank: '#',
    rankingsHand: 'Рука',
    rankingsType: 'Тип',
    rankingsCombos: 'Комбо',
    rankingsPercentile: 'Ранг%',
    rankingsNote: 'Руки канонизированы по мастям: структурно идентичные руки (отличающиеся только мастями) сгруппированы. Каждая каноническая рука оценена с помощью 10 000 MC-триалов vs случайный оппонент.',
    rankingsInfoButton: 'Как работает рейтинг',
    rankingsInfoTitle: 'Как работает рейтинг рук PLO5',
    rankingsInfoMethodTitle: 'Методология',
    rankingsInfoMethod: 'Каждая из 134 459 канонических (изоморфных по мастям) стартовых рук PLO5 оценивается против случайного оппонента с помощью симуляции Монте-Карло. Показанное эквити — средний процент побед на тысячах случайно разданных бордов.',
    rankingsInfoCRNTitle: 'Общие случайные числа (CRN)',
    rankingsInfoCRN: 'Для стабильных и воспроизводимых результатов движок использует технику CRN: один и тот же набор случайных бордов используется для всех рук. Это значительно снижает относительную дисперсию между руками — даже при меньшем числе триалов порядок рейтинга остаётся надёжным.',
    rankingsInfoCanonTitle: 'Канонизация по мастям',
    rankingsInfoCanon: 'Руки, отличающиеся только мастями, структурно идентичны (например, AhKhQdJd5c и AsKsQcJc5d играются одинаково). Они группируются в одну каноническую руку. Колонка «Комбо» показывает, сколько конкретных раздач соответствует каждой канонической форме (обычно 4-24).',
    rankingsInfoColumnsTitle: 'Описание колонок',
    rankingsInfoColumnRank: '# — Глобальный ранг (1 = лучшая рука)',
    rankingsInfoColumnHand: 'Рука — 5 карт в канонической масти',
    rankingsInfoColumnCombos: 'Комбо — Количество конкретных раздач из 5 карт, соответствующих этой канонической руке',
    rankingsInfoColumnEQ: 'EQ% — Эквити на префлопе vs случайный оппонент (Монте-Карло)',
    rankingsInfoColumnRankPct: 'Ранг% — Позиция в процентиле (0% = топ, 100% = низ)',
    rankingsInfoSearchTitle: 'Синтаксис поиска',
    rankingsInfoSearch: 'Используйте синтаксис в стиле ProPokerTools для фильтрации рук. Примеры: AA (любая рука с парой тузов), KK+ (короли и лучше), TT+ds (десятки+ дабл-сьюитед), 20% (топ-20% рук), 5%-10% (руки между 5-м и 10-м процентилями).',
    rankingsEquity: 'EQ%',
    rankingsTotal: 'Всего рук',
    rankingsCanonicalTotal: '{n} канонических рук (изоморфных по мастям)',
    rankingsShowing: 'Показано',
    rankingsPerPage: 'На странице',
    rankingsDbNotFound: 'База рейтинга рук не найдена',
    rankingsDbNotFoundDesc: 'База рейтинга рук не найдена. Запустите scripts/precompute_rankings.',
    rankingsDS: 'дс',
    rankingsSS: 'сс',
    rankingsSearch: 'Поиск руки или процент',
    rankingsSearchPlaceholder: 'AA, AA!KK, KK+, TT+ds, AA,KK, 20%',
    rankingsFound: 'Найдено',
    rankingsTopPercent: 'Топ {n}%',
    rankingsPercentRange: '{a}% — {b}%',
    rankingsNoResults: 'Руки не найдены',
    rankingsNotReady: 'Рейтинг рук готовится. Пожалуйста, проверьте позже.',
    catAll: 'Все руки',
    catUnpaired: 'Без пар',
    catOnePair: 'Одна пара',
    catTwoPair: 'Две пары',
    catTrips: 'Тройка',
    catDS: 'Дабл-сьюитед',
    catSS: 'Сингл-сьюитед',
    catRundown5: '5-карточный ранд.',
    catRundown4: '4-карточный ранд.',
    catBroadway3: '3+ Бродвей',
    catBroadway2Low3: '2 Бродвей + мелкие',
    catRagged: 'Ragged',
    catCategories: 'Категории',
    catHandsCount: '{n} рук',
    trialsLabel: 'Пробы',
    seedLabel: 'Сид',
    seedPlaceholder: 'напр. 12345',
    benchmark: 'Бенчмарк',
    benchmarkRunning: 'Запуск...',
    benchmarkDone: 'Бенчмарк выполнен',
    need5Cards: 'Нужно ровно 5 карт',
    trialsShort100k: '100K',
    trialsShort300k: '300K',
    trialsShort600k: '600K',
    trialsShort2m: '2M',
    serverCalculating: 'Расчёт на сервере...',
    serverBusy: 'Сервер занят, попробуйте через минуту',
    serverError: 'Ошибка сервера',
    serverTimeout: 'Расчёт превысил время ожидания',
    engineLabel: 'Rust движок',
    breakdownTitle: 'Разбивка EQ (след. улица)',
    breakdownEmpty: 'Запустите расчёт с включённой разбивкой, чтобы увидеть эквити по картам',
    breakdownDesc: 'Эквити для каждой возможной следующей карты',
    breakdownToggle: 'Показать разбивку EQ',
    breakdownRunning: 'Расчёт разбивки...',
    breakdownCard: 'Карта',
    breakdownEquity: 'Эквити',
    breakdownTrials: 'Пробы',
    breakdownShowAll: 'Показать все ({n})',
    breakdownShowTop: 'Показать топ 20',
    breakdownFlopToTurn: 'Флоп → Тёрн',
    breakdownTurnToRiver: 'Тёрн → Ривер',
    breakdownNotAvailable: 'Разбивка доступна только на Флопе или Тёрне',
    breakdownBudget: 'Бюджет',
    breakdownBaseline: 'Базовое эквити (текущая улица)',
    breakdownDelta: 'Δ',
    breakdownFilterBetter: 'Только лучше базового',
    breakdownShowTopN: 'Топ {n}',
    breakdownTabCards: 'Карты',
    breakdownTabByRank: 'По рангу',
    breakdownRank: 'Ранг',
    breakdownAvgEquity: 'Сред. EQ',
    breakdownBestSuit: 'Лучшая',
    breakdownCount: 'Кол-во',
    breakdownNormalize: 'Нормализация баров',
  },
} as const;

type TranslationKey = keyof typeof translations.en;

interface I18nContextType {
  lang: Lang;
  setLang: (lang: Lang) => void;
  t: (key: TranslationKey) => string;
}

const I18nContext = createContext<I18nContextType | null>(null);

export function I18nProvider({ children }: { children: ReactNode }) {
  const [lang, setLangState] = useState<Lang>(() => {
    if (typeof window !== 'undefined') {
      const saved = localStorage.getItem('plozilla-lang');
      if (saved === 'ru' || saved === 'en') return saved;
    }
    return 'en';
  });

  const setLang = (newLang: Lang) => {
    setLangState(newLang);
    localStorage.setItem('plozilla-lang', newLang);
  };

  const t = (key: TranslationKey): string => {
    return translations[lang][key] || translations.en[key] || key;
  };

  return (
    <I18nContext.Provider value={{ lang, setLang, t }}>
      {children}
    </I18nContext.Provider>
  );
}

export function useTranslation() {
  const ctx = useContext(I18nContext);
  if (!ctx) throw new Error('useTranslation must be used within I18nProvider');
  return ctx;
}
